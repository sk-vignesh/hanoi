<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tower of Hanoi</title>
  <style>
    /* Basic page styling */
    body {
      font-family: Arial, sans-serif;       /* Use a clean, sans-serif font */
      text-align: center;                  /* Center-align all text */
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;           /* Light grey background */
    }

    /* Heading spacing */
    h1 {
      margin-bottom: 10px;
    }

    /* Controls section spacing */
    #controls {
      margin-bottom: 20px;
    }

    /* Game container: three pegs side by side */
    #game {
      display: flex;
      justify-content: space-around;       /* Even space around each peg */
      align-items: flex-end;               /* Align pegs to bottom */
      height: 300px;                       /* Fixed height for tower area */
    }

    /* Individual peg styling */
    .peg {
      flex: 1;                             /* Pegs share available width equally */
      max-width: 150px;                    /* Prevent pegs from getting too wide */
      border-top: 10px solid #555;         /* Visual representation of the peg top */
      position: relative;                  /* For absolute-positioned disks inside */
      cursor: pointer;                     /* Indicate clickable area */
      background-color: #e0e0e0;
      margin: 0 10px;
    }

    /* Highlight selected peg */
    .peg.selected {
      background-color: #d1ecf1;
    }

    /* Disk styling: colored rectangles with rounded corners */
    .disk {
      position: absolute;                  /* Stack on bottom of pegs */
      height: 20px;
      border-radius: 4px;
      background-color: #3498db;
      border: 2px solid #2980b9;
      box-sizing: border-box;
      left: 50%;                           /* Center horizontally */
      transform: translateX(-50%);
      cursor: pointer;
    }

    /* Move counter spacing */
    #moves {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Tower of Hanoi</h1>

  <!-- Control panel: select number of disks and reset button -->
  <div id="controls">
    <label for="numDisks">Number of Disks:</label>
    <select id="numDisks">
      <option>3</option>
      <option>4</option>
      <option>5</option>
      <option>6</option>
    </select>
    <button id="reset">Reset</button>
  </div>

  <!-- Game area: three pegs for disks -->
  <div id="game">
    <div class="peg" data-peg="0"></div>
    <div class="peg" data-peg="1"></div>
    <div class="peg" data-peg="2"></div>
  </div>

  <!-- Display move count -->
  <div id="moves">Moves: <span id="moveCount">0</span></div>

  <script>
    // Constants for disk sizing
    const MIN_WIDTH = 30;    // px for smallest disk
    const MAX_WIDTH = 120;   // px for largest disk

    // Game state variables
    const pegs = [[], [], []];
    let selectedPeg = null;    // Index of peg selected to move a disk from
    let moveCount = 0;         // Tracks number of valid moves made
    let totalDisks = 0;        // Total number of disks in current game
    let diskWidths = [];       // Precomputed widths for disk sizes

    // Cache DOM elements for performance
    const moveCountEl = document.getElementById('moveCount');
    const numDisksEl = document.getElementById('numDisks');
    const resetBtn = document.getElementById('reset');

    /**
     * Initialize or reset the game state
     */
    function init() {
      const n = parseInt(numDisksEl.value, 10);
      totalDisks = n;

      // Precompute widths so they never change mid-game
      diskWidths = new Array(n + 1);
      for (let size = 1; size <= n; size++) {
        diskWidths[size] =
          MIN_WIDTH +
          (size - 1) * ((MAX_WIDTH - MIN_WIDTH) / (n - 1));
      }

      // Fill first peg with disks of sizes n down to 1
      pegs[0] = Array.from({ length: n }, (_, i) => n - i);
      pegs[1] = [];
      pegs[2] = [];

      moveCount = 0;
      moveCountEl.textContent = moveCount;
      selectedPeg = null;

      render();
    }

    /**
     * Render disks on each peg based on the pegs[] data
     */
    function render() {
      document.querySelectorAll('.peg').forEach(pegEl => {
        const idx = +pegEl.dataset.peg;
        pegEl.innerHTML = '';

        pegs[idx].forEach((size, i) => {
          const disk = document.createElement('div');
          disk.className = 'disk';

          // Lookup precomputed width
          disk.style.width = diskWidths[size] + 'px';
          disk.style.bottom = i * 22 + 'px';

          pegEl.appendChild(disk);
        });

        pegEl.classList.toggle('selected', selectedPeg === idx);
      });
    }

    /**
     * Handle clicks on a peg: select or move a disk
     */
    function handlePegClick(e) {
      const pegIdx = +e.currentTarget.dataset.peg;

      if (selectedPeg === null) {
        // Pick up top disk
        if (pegs[pegIdx].length === 0) return;
        selectedPeg = pegIdx;
      } else {
        // Attempt to place disk
        if (selectedPeg !== pegIdx) {
          const from = selectedPeg;
          const to = pegIdx;
          const disk = pegs[from].slice(-1)[0];
          const targetTop = pegs[to].slice(-1)[0] || Infinity;

          if (disk < targetTop) {
            pegs[to].push(pegs[from].pop());
            moveCount++;
            moveCountEl.textContent = moveCount;
          }
        }
        selectedPeg = null;
      }

      render();
      checkWin();
    }

    /**
     * Check for win condition: all disks moved to last peg
     */
    function checkWin() {
      if (pegs[2].length === totalDisks) {
        setTimeout(() => alert(`Congratulations! You solved it in ${moveCount} moves.`), 10);
      }
    }

    // Attach event listeners
    document.querySelectorAll('.peg').forEach(pegEl => {
      pegEl.addEventListener('click', handlePegClick);
    });

    resetBtn.addEventListener('click', init);
    numDisksEl.addEventListener('change', init);

    // Start the game
    init();
  </script>
</body>
</html>
